function cov_1y1fzkry2i(){var path="D:\\Arkademy\\Ceritakopi-Backend\\src\\controllers\\auth.js";var hash="0fc06354415e013441b847a86b35db39097eef42";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Arkademy\\Ceritakopi-Backend\\src\\controllers\\auth.js",statementMap:{"0":{start:{line:2,column:18},end:{line:2,column:43}},"1":{start:{line:3,column:19},end:{line:3,column:53}},"2":{start:{line:4,column:15},end:{line:4,column:32}},"3":{start:{line:5,column:12},end:{line:5,column:35}},"4":{start:{line:6,column:25},end:{line:6,column:36}},"5":{start:{line:7,column:19},end:{line:7,column:40}},"6":{start:{line:8,column:14},end:{line:8,column:46}},"7":{start:{line:10,column:0},end:{line:28,column:2}},"8":{start:{line:11,column:17},end:{line:11,column:25}},"9":{start:{line:12,column:23},end:{line:12,column:65}},"10":{start:{line:13,column:4},end:{line:15,column:5}},"11":{start:{line:14,column:8},end:{line:14,column:57}},"12":{start:{line:16,column:29},end:{line:16,column:84}},"13":{start:{line:17,column:4},end:{line:19,column:5}},"14":{start:{line:18,column:8},end:{line:18,column:64}},"15":{start:{line:20,column:4},end:{line:27,column:5}},"16":{start:{line:21,column:27},end:{line:21,column:51}},"17":{start:{line:22,column:8},end:{line:22,column:69}},"18":{start:{line:23,column:8},end:{line:23,column:41}},"19":{start:{line:24,column:8},end:{line:24,column:78}},"20":{start:{line:26,column:8},end:{line:26,column:57}},"21":{start:{line:30,column:0},end:{line:59,column:2}},"22":{start:{line:31,column:30},end:{line:31,column:38}},"23":{start:{line:32,column:23},end:{line:32,column:60}},"24":{start:{line:34,column:4},end:{line:36,column:5}},"25":{start:{line:35,column:8},end:{line:35,column:53}},"26":{start:{line:37,column:17},end:{line:37,column:30}},"27":{start:{line:39,column:27},end:{line:39,column:65}},"28":{start:{line:40,column:30},end:{line:40,column:71}},"29":{start:{line:41,column:20},end:{line:41,column:65}},"30":{start:{line:42,column:4},end:{line:49,column:5}},"31":{start:{line:43,column:8},end:{line:48,column:9}},"32":{start:{line:44,column:26},end:{line:44,column:107}},"33":{start:{line:45,column:12},end:{line:45,column:73}},"34":{start:{line:47,column:12},end:{line:47,column:66}},"35":{start:{line:50,column:4},end:{line:57,column:5}},"36":{start:{line:51,column:8},end:{line:56,column:9}},"37":{start:{line:52,column:26},end:{line:52,column:107}},"38":{start:{line:53,column:12},end:{line:53,column:67}},"39":{start:{line:55,column:12},end:{line:55,column:66}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:17},end:{line:10,column:18}},loc:{start:{line:10,column:37},end:{line:28,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:30,column:16},end:{line:30,column:17}},loc:{start:{line:30,column:36},end:{line:59,column:1}},line:30}},branchMap:{"0":{loc:{start:{line:13,column:4},end:{line:15,column:5}},type:"if",locations:[{start:{line:13,column:4},end:{line:15,column:5}},{start:{line:13,column:4},end:{line:15,column:5}}],line:13},"1":{loc:{start:{line:17,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:19,column:5}},{start:{line:17,column:4},end:{line:19,column:5}}],line:17},"2":{loc:{start:{line:20,column:4},end:{line:27,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:27,column:5}},{start:{line:20,column:4},end:{line:27,column:5}}],line:20},"3":{loc:{start:{line:34,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:36,column:5}},{start:{line:34,column:4},end:{line:36,column:5}}],line:34},"4":{loc:{start:{line:42,column:4},end:{line:49,column:5}},type:"if",locations:[{start:{line:42,column:4},end:{line:49,column:5}},{start:{line:42,column:4},end:{line:49,column:5}}],line:42},"5":{loc:{start:{line:43,column:8},end:{line:48,column:9}},type:"if",locations:[{start:{line:43,column:8},end:{line:48,column:9}},{start:{line:43,column:8},end:{line:48,column:9}}],line:43},"6":{loc:{start:{line:50,column:4},end:{line:57,column:5}},type:"if",locations:[{start:{line:50,column:4},end:{line:57,column:5}},{start:{line:50,column:4},end:{line:57,column:5}}],line:50},"7":{loc:{start:{line:51,column:8},end:{line:56,column:9}},type:"if",locations:[{start:{line:51,column:8},end:{line:56,column:9}},{start:{line:51,column:8},end:{line:56,column:9}}],line:51}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0fc06354415e013441b847a86b35db39097eef42"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1y1fzkry2i=function(){return actualCoverage;};}return actualCoverage;}cov_1y1fzkry2i();/* eslint-disable no-undef */const authModel=(cov_1y1fzkry2i().s[0]++,require('../models/auth'));const{response}=(cov_1y1fzkry2i().s[1]++,require('../helpers/formResponse'));const bycrpt=(cov_1y1fzkry2i().s[2]++,require('bcrypt'));const jwt=(cov_1y1fzkry2i().s[3]++,require('jsonwebtoken'));const{APP_SECRET_KEY}=(cov_1y1fzkry2i().s[4]++,process.env);const nodemailer=(cov_1y1fzkry2i().s[5]++,require('nodemailer'));const regex=(cov_1y1fzkry2i().s[6]++,require('../helpers/validation'));cov_1y1fzkry2i().s[7]++;exports.signup=async(req,res)=>{cov_1y1fzkry2i().f[0]++;const data=(cov_1y1fzkry2i().s[8]++,req.body);const checkEmail=(cov_1y1fzkry2i().s[9]++,await authModel.getUserByEmail(data.email));cov_1y1fzkry2i().s[10]++;if(checkEmail.length>0){cov_1y1fzkry2i().b[0][0]++;cov_1y1fzkry2i().s[11]++;return response(res,401,"Email already exist!");}else{cov_1y1fzkry2i().b[0][1]++;}const checkPhoneNumber=(cov_1y1fzkry2i().s[12]++,await authModel.getUserByPhoneNumber(data.phone_number));cov_1y1fzkry2i().s[13]++;if(checkPhoneNumber.length>0){cov_1y1fzkry2i().b[1][0]++;cov_1y1fzkry2i().s[14]++;return response(res,401,"Phone number already exist!");}else{cov_1y1fzkry2i().b[1][1]++;}cov_1y1fzkry2i().s[15]++;if(regex.validateEmail(data.email)){cov_1y1fzkry2i().b[2][0]++;const saltRounds=(cov_1y1fzkry2i().s[16]++,await bycrpt.genSalt(10));cov_1y1fzkry2i().s[17]++;data.password=await bycrpt.hash(data.password,saltRounds);cov_1y1fzkry2i().s[18]++;await authModel.createUser(data);cov_1y1fzkry2i().s[19]++;return response(res,200,'Create user has been successfully!',data);}else{cov_1y1fzkry2i().b[2][1]++;cov_1y1fzkry2i().s[20]++;return response(res,401,'Email is not valid!');}};cov_1y1fzkry2i().s[21]++;exports.login=async(req,res)=>{cov_1y1fzkry2i().f[1]++;const{email,password}=(cov_1y1fzkry2i().s[22]++,req.body);const checkEmail=(cov_1y1fzkry2i().s[23]++,await authModel.getUserByEmail(email));cov_1y1fzkry2i().s[24]++;if(checkEmail.length<1){cov_1y1fzkry2i().b[3][0]++;cov_1y1fzkry2i().s[25]++;return response(res,404,"email not found!");}else{cov_1y1fzkry2i().b[3][1]++;}const user=(cov_1y1fzkry2i().s[26]++,checkEmail[0]);// console.log('data user: ', user);
const checkRoleAdmin=(cov_1y1fzkry2i().s[27]++,await authModel.getUserByRole('admin'));const checkRoleCustomer=(cov_1y1fzkry2i().s[28]++,await authModel.getUserByRole('customer'));const compare=(cov_1y1fzkry2i().s[29]++,await bycrpt.compare(password,user.password));cov_1y1fzkry2i().s[30]++;if(user.role==='admin'){cov_1y1fzkry2i().b[4][0]++;cov_1y1fzkry2i().s[31]++;if(compare){cov_1y1fzkry2i().b[5][0]++;const token=(cov_1y1fzkry2i().s[32]++,jwt.sign({id:user.id,email:user.email},APP_SECRET_KEY,{expiresIn:'1h'}));cov_1y1fzkry2i().s[33]++;return response(res,200,'Login Admin Success!',{token});}else{cov_1y1fzkry2i().b[5][1]++;cov_1y1fzkry2i().s[34]++;return response(res,401,'Wrong email or password!');}}else{cov_1y1fzkry2i().b[4][1]++;}cov_1y1fzkry2i().s[35]++;if(user.role==='customer'){cov_1y1fzkry2i().b[6][0]++;cov_1y1fzkry2i().s[36]++;if(compare){cov_1y1fzkry2i().b[7][0]++;const token=(cov_1y1fzkry2i().s[37]++,jwt.sign({id:user.id,email:user.email},APP_SECRET_KEY,{expiresIn:'1h'}));cov_1y1fzkry2i().s[38]++;return response(res,200,'Login Success!',{token});}else{cov_1y1fzkry2i().b[7][1]++;cov_1y1fzkry2i().s[39]++;return response(res,401,'Wrong email or password!');}}else{cov_1y1fzkry2i().b[6][1]++;}};// exports.forgotPassword  = async (req, res) => {
//     const{email} = req.body;
//     const checkEmail = await authModel.checkEmail(email);
//     try {
//         if (checkEmail.length < 1) {
//             return response(res, 404, 'Email not found!')
//         } else {
//             if (results[0]) {
//                 const user = results[0];
//                 const tokenForgot = jwt.sign({
//                     id: user.id,
//                     email: user.email
//                 }, APP_SECRET_KEY, {
//                     expiresIn: '24h'
//                 });
//                 //Nodemailer: 
//                 let transporter = nodemailer.createTransport({
//                     service: 'gmail',
//                     host: 'smtp.gmail.com',
//                     port: 578,
//                     secure: false,
//                     auth: {
//                         user: process.env.USER_EMAIL,
//                         pass: process.env.PASS_EMAIL
//                     }
//                 });
//                 let mailOptions = {
//                     from: '<noreply@gmail.com>',
//                     to: req.body.email,
//                     subject: 'Generate Link for Reset Password from BravoTeam',
//                     html: ` <h3> Link  to Reset Password </h3>
//                             <p> Hello, this is your link: ${process.env.APP_URL}/auth/reset-password/${tokenForgot} </p>`
//                 };
//                 transporter.sendMail(mailOptions, (err) => {
//                     if (err) {
//                         console.log('Its Error: ', err);
//                     } else {
//                         console.log('Sent Success!!!!');
//                     }
//                 });
//                 return response(res, 200, 'Your link has been sent in your mail!');
//             }
//             else {
//                 return response(res, 404, 'Your email is not found!');
//             }
//         }
//     } catch (error) {
//         return response(res, 500, 'error occured!', error)
//     }
// };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiYXV0aE1vZGVsIiwicmVxdWlyZSIsInJlc3BvbnNlIiwiYnljcnB0Iiwiand0IiwiQVBQX1NFQ1JFVF9LRVkiLCJwcm9jZXNzIiwiZW52Iiwibm9kZW1haWxlciIsInJlZ2V4IiwiZXhwb3J0cyIsInNpZ251cCIsInJlcSIsInJlcyIsImRhdGEiLCJib2R5IiwiY2hlY2tFbWFpbCIsImdldFVzZXJCeUVtYWlsIiwiZW1haWwiLCJsZW5ndGgiLCJjaGVja1Bob25lTnVtYmVyIiwiZ2V0VXNlckJ5UGhvbmVOdW1iZXIiLCJwaG9uZV9udW1iZXIiLCJ2YWxpZGF0ZUVtYWlsIiwic2FsdFJvdW5kcyIsImdlblNhbHQiLCJwYXNzd29yZCIsImhhc2giLCJjcmVhdGVVc2VyIiwibG9naW4iLCJ1c2VyIiwiY2hlY2tSb2xlQWRtaW4iLCJnZXRVc2VyQnlSb2xlIiwiY2hlY2tSb2xlQ3VzdG9tZXIiLCJjb21wYXJlIiwicm9sZSIsInRva2VuIiwic2lnbiIsImlkIiwiZXhwaXJlc0luIl0sIm1hcHBpbmdzIjoidTVKQWVZOzJGQWZaLDZCQUNBLEtBQU1BLENBQUFBLFNBQVMsMEJBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUFWLENBQWYsQ0FDQSxLQUFNLENBQUNDLFFBQUQsMkJBQWFELE9BQU8sQ0FBQyx5QkFBRCxDQUFwQixDQUFOLENBQ0EsS0FBTUUsQ0FBQUEsTUFBTSwwQkFBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUcsQ0FBQUEsR0FBRywwQkFBR0gsT0FBTyxDQUFDLGNBQUQsQ0FBVixDQUFULENBQ0EsS0FBTSxDQUFDSSxjQUFELDJCQUFtQkMsT0FBTyxDQUFDQyxHQUEzQixDQUFOLENBQ0EsS0FBTUMsQ0FBQUEsVUFBVSwwQkFBR1AsT0FBTyxDQUFDLFlBQUQsQ0FBVixDQUFoQixDQUNBLEtBQU1RLENBQUFBLEtBQUssMEJBQUdSLE9BQU8sQ0FBQyx1QkFBRCxDQUFWLENBQVgsQyx3QkFFQVMsT0FB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cclxuY29uc3QgYXV0aE1vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWxzL2F1dGgnKTtcclxuY29uc3Qge3Jlc3BvbnNlfSA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvZm9ybVJlc3BvbnNlJyk7XHJcbmNvbnN0IGJ5Y3JwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpO1xyXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcclxuY29uc3Qge0FQUF9TRUNSRVRfS0VZfSA9IHByb2Nlc3MuZW52O1xyXG5jb25zdCBub2RlbWFpbGVyID0gcmVxdWlyZSgnbm9kZW1haWxlcicpO1xyXG5jb25zdCByZWdleCA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvdmFsaWRhdGlvbicpO1xyXG5cclxuZXhwb3J0cy5zaWdudXAgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IGRhdGEgPSByZXEuYm9keTtcclxuICAgIGNvbnN0IGNoZWNrRW1haWwgPSBhd2FpdCBhdXRoTW9kZWwuZ2V0VXNlckJ5RW1haWwoZGF0YS5lbWFpbCk7XHJcbiAgICBpZiAoY2hlY2tFbWFpbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKHJlcywgNDAxLCBcIkVtYWlsIGFscmVhZHkgZXhpc3QhXCIpXHJcbiAgICB9IFxyXG4gICAgY29uc3QgY2hlY2tQaG9uZU51bWJlciA9IGF3YWl0IGF1dGhNb2RlbC5nZXRVc2VyQnlQaG9uZU51bWJlcihkYXRhLnBob25lX251bWJlcik7XHJcbiAgICBpZiAoY2hlY2tQaG9uZU51bWJlci5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKHJlcywgNDAxLCBcIlBob25lIG51bWJlciBhbHJlYWR5IGV4aXN0IVwiKVxyXG4gICAgfVxyXG4gICAgaWYgKHJlZ2V4LnZhbGlkYXRlRW1haWwoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgICBjb25zdCBzYWx0Um91bmRzID0gYXdhaXQgYnljcnB0LmdlblNhbHQoMTApO1xyXG4gICAgICAgIGRhdGEucGFzc3dvcmQgPSBhd2FpdCBieWNycHQuaGFzaChkYXRhLnBhc3N3b3JkLCBzYWx0Um91bmRzKTtcclxuICAgICAgICBhd2FpdCBhdXRoTW9kZWwuY3JlYXRlVXNlcihkYXRhKTtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UocmVzLCAyMDAsICdDcmVhdGUgdXNlciBoYXMgYmVlbiBzdWNjZXNzZnVsbHkhJywgZGF0YSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZShyZXMsIDQwMSwgJ0VtYWlsIGlzIG5vdCB2YWxpZCEnKTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydHMubG9naW4gPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IHtlbWFpbCwgcGFzc3dvcmR9ID0gcmVxLmJvZHk7XHJcbiAgICBjb25zdCBjaGVja0VtYWlsID0gYXdhaXQgYXV0aE1vZGVsLmdldFVzZXJCeUVtYWlsKGVtYWlsKVxyXG5cclxuICAgIGlmKGNoZWNrRW1haWwubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZShyZXMsIDQwNCwgXCJlbWFpbCBub3QgZm91bmQhXCIpXHJcbiAgICB9IFxyXG4gICAgY29uc3QgdXNlciA9IGNoZWNrRW1haWxbMF07XHJcbiAgICAvLyBjb25zb2xlLmxvZygnZGF0YSB1c2VyOiAnLCB1c2VyKTtcclxuICAgIGNvbnN0IGNoZWNrUm9sZUFkbWluID0gYXdhaXQgYXV0aE1vZGVsLmdldFVzZXJCeVJvbGUoJ2FkbWluJyk7XHJcbiAgICBjb25zdCBjaGVja1JvbGVDdXN0b21lciA9IGF3YWl0IGF1dGhNb2RlbC5nZXRVc2VyQnlSb2xlKCdjdXN0b21lcicpO1xyXG4gICAgY29uc3QgY29tcGFyZSA9IGF3YWl0IGJ5Y3JwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKTtcclxuICAgIGlmKHVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xyXG4gICAgICAgIGlmIChjb21wYXJlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oeyBpZDogdXNlci5pZCwgZW1haWw6IHVzZXIuZW1haWwgfSwgQVBQX1NFQ1JFVF9LRVksIHsgZXhwaXJlc0luOiAnMWgnIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UocmVzLCAyMDAsICdMb2dpbiBBZG1pbiBTdWNjZXNzIScsIHsgdG9rZW4gfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKHJlcywgNDAxLCAnV3JvbmcgZW1haWwgb3IgcGFzc3dvcmQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBcclxuICAgIGlmICh1c2VyLnJvbGUgPT09ICdjdXN0b21lcicpIHtcclxuICAgICAgICBpZiAoY29tcGFyZSkge1xyXG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHsgaWQ6IHVzZXIuaWQsIGVtYWlsOiB1c2VyLmVtYWlsIH0sIEFQUF9TRUNSRVRfS0VZLCB7IGV4cGlyZXNJbjogJzFoJyB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKHJlcywgMjAwLCAnTG9naW4gU3VjY2VzcyEnLCB7IHRva2VuIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZShyZXMsIDQwMSwgJ1dyb25nIGVtYWlsIG9yIHBhc3N3b3JkIScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG59O1xyXG5cclxuLy8gZXhwb3J0cy5mb3Jnb3RQYXNzd29yZCAgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICAgIGNvbnN0e2VtYWlsfSA9IHJlcS5ib2R5O1xyXG4gICAgXHJcbi8vICAgICBjb25zdCBjaGVja0VtYWlsID0gYXdhaXQgYXV0aE1vZGVsLmNoZWNrRW1haWwoZW1haWwpO1xyXG4vLyAgICAgdHJ5IHtcclxuLy8gICAgICAgICBpZiAoY2hlY2tFbWFpbC5sZW5ndGggPCAxKSB7XHJcbi8vICAgICAgICAgICAgIHJldHVybiByZXNwb25zZShyZXMsIDQwNCwgJ0VtYWlsIG5vdCBmb3VuZCEnKVxyXG4vLyAgICAgICAgIH0gZWxzZSB7XHJcbi8vICAgICAgICAgICAgIGlmIChyZXN1bHRzWzBdKSB7XHJcbi8vICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gcmVzdWx0c1swXTtcclxuLy8gICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuRm9yZ290ID0gand0LnNpZ24oe1xyXG4vLyAgICAgICAgICAgICAgICAgICAgIGlkOiB1c2VyLmlkLFxyXG4vLyAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsXHJcbi8vICAgICAgICAgICAgICAgICB9LCBBUFBfU0VDUkVUX0tFWSwge1xyXG4vLyAgICAgICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogJzI0aCdcclxuLy8gICAgICAgICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgICAgICAgICAgLy9Ob2RlbWFpbGVyOiBcclxuLy8gICAgICAgICAgICAgICAgIGxldCB0cmFuc3BvcnRlciA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcclxuLy8gICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnZ21haWwnLFxyXG4vLyAgICAgICAgICAgICAgICAgICAgIGhvc3Q6ICdzbXRwLmdtYWlsLmNvbScsXHJcbi8vICAgICAgICAgICAgICAgICAgICAgcG9ydDogNTc4LFxyXG4vLyAgICAgICAgICAgICAgICAgICAgIHNlY3VyZTogZmFsc2UsXHJcbi8vICAgICAgICAgICAgICAgICAgICAgYXV0aDoge1xyXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiBwcm9jZXNzLmVudi5VU0VSX0VNQUlMLFxyXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzOiBwcm9jZXNzLmVudi5QQVNTX0VNQUlMXHJcbi8vICAgICAgICAgICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4vLyAgICAgICAgICAgICAgICAgbGV0IG1haWxPcHRpb25zID0ge1xyXG4vLyAgICAgICAgICAgICAgICAgICAgIGZyb206ICc8bm9yZXBseUBnbWFpbC5jb20+JyxcclxuLy8gICAgICAgICAgICAgICAgICAgICB0bzogcmVxLmJvZHkuZW1haWwsXHJcbi8vICAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogJ0dlbmVyYXRlIExpbmsgZm9yIFJlc2V0IFBhc3N3b3JkIGZyb20gQnJhdm9UZWFtJyxcclxuLy8gICAgICAgICAgICAgICAgICAgICBodG1sOiBgIDxoMz4gTGluayAgdG8gUmVzZXQgUGFzc3dvcmQgPC9oMz5cclxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPiBIZWxsbywgdGhpcyBpcyB5b3VyIGxpbms6ICR7cHJvY2Vzcy5lbnYuQVBQX1VSTH0vYXV0aC9yZXNldC1wYXNzd29yZC8ke3Rva2VuRm9yZ290fSA8L3A+YFxyXG4vLyAgICAgICAgICAgICAgICAgfTtcclxuLy8gICAgICAgICAgICAgICAgIHRyYW5zcG9ydGVyLnNlbmRNYWlsKG1haWxPcHRpb25zLCAoZXJyKSA9PiB7XHJcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSXRzIEVycm9yOiAnLCBlcnIpO1xyXG4vLyAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZW50IFN1Y2Nlc3MhISEhJyk7XHJcbi8vICAgICAgICAgICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UocmVzLCAyMDAsICdZb3VyIGxpbmsgaGFzIGJlZW4gc2VudCBpbiB5b3VyIG1haWwhJyk7XHJcbi8vICAgICAgICAgICAgIH1cclxuLy8gICAgICAgICAgICAgZWxzZSB7XHJcbi8vICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UocmVzLCA0MDQsICdZb3VyIGVtYWlsIGlzIG5vdCBmb3VuZCEnKTtcclxuLy8gICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgIH1cclxuLy8gICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbi8vICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKHJlcywgNTAwLCAnZXJyb3Igb2NjdXJlZCEnLCBlcnJvcilcclxuLy8gICAgIH1cclxuLy8gfTsiXX0=